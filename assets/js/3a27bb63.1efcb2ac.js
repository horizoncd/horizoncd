"use strict";(self.webpackChunkhorizon_docs=self.webpackChunkhorizon_docs||[]).push([[195],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>m});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=r.createContext({}),d=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=d(e.components);return r.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=d(t),m=o,k=u["".concat(s,".").concat(m)]||u[m]||c[m]||a;return t?r.createElement(k,i(i({ref:n},p),{},{components:t})):r.createElement(k,i({ref:n},p))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var d=2;d<a;d++)i[d]=t[d];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},7167:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var r=t(7462),o=(t(7294),t(3905));const a={title:"How to Install",toc_max_heading_level:6},i=void 0,l={unversionedId:"tutorials/how-to-install",id:"tutorials/how-to-install",title:"How to Install",description:"This section describes how to perform a new installation of Horizon.",source:"@site/docs/tutorials/how-to-install.md",sourceDirName:"tutorials",slug:"/tutorials/how-to-install",permalink:"/docs/tutorials/how-to-install",draft:!1,editUrl:"https://github.com/horizoncd/horizoncd.github.io/blob/master/docs/docs/tutorials/how-to-install.md",tags:[],version:"current",lastUpdatedBy:"kiloson",lastUpdatedAt:1673760126,formattedLastUpdatedAt:"Jan 15, 2023",frontMatter:{title:"How to Install",toc_max_heading_level:6},sidebar:"docs",previous:{title:"Horizon",permalink:"/docs/"},next:{title:"How to deploy your first workload",permalink:"/docs/tutorials/how-to-deploy-your-first-workload"}},s={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Hardware",id:"hardware",level:3},{value:"Requirements",id:"requirements",level:3},{value:"Installation Process",id:"installation-process",level:2},{value:"Known Issues",id:"known-issues",level:3},{value:"Horizon Components",id:"horizon-components",level:2}],p={toc:d};function c(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This section describes how to perform a new installation of Horizon."),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"Horizon is built entirely on Kubernetes and has been fully tested on its v1.19.3 release."),(0,o.kt)("p",null,"We are assuming you have a basic understanding of what the Kubernetes is and how it runs."),(0,o.kt)("p",null,"You can use ",(0,o.kt)("a",{parentName:"p",href:"https://kind.sigs.k8s.io/docs/user/quick-start/"},"Kind")," to run a local Kubernetes cluster quickly. ",(0,o.kt)("a",{parentName:"p",href:"https://minikube.sigs.k8s.io/docs/"},"Minikube")," is another highly useful tool to set up a local Kubernetes cluster."),(0,o.kt)("h3",{id:"hardware"},"Hardware"),(0,o.kt)("p",null,"The following table lists the minimum and recommended hardware configurations for deploying Horizon."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Resource"),(0,o.kt)("th",{parentName:"tr",align:null},"Minimum"),(0,o.kt)("th",{parentName:"tr",align:null},"Recommended"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"CPU"),(0,o.kt)("td",{parentName:"tr",align:null},"4 CPU"),(0,o.kt)("td",{parentName:"tr",align:null},"8 CPU")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Mem"),(0,o.kt)("td",{parentName:"tr",align:null},"8 GB"),(0,o.kt)("td",{parentName:"tr",align:null},"16 GB")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Disk"),(0,o.kt)("td",{parentName:"tr",align:null},"40 GB"),(0,o.kt)("td",{parentName:"tr",align:null},"80 GB")))),(0,o.kt)("h3",{id:"requirements"},"Requirements"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/"},"Kubernetes")," cluster version 1.19.3 or later."),(0,o.kt)("li",{parentName:"ul"},"Installed ",(0,o.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl/"},"kubectl")," command-line tool."),(0,o.kt)("li",{parentName:"ul"},"Have a ",(0,o.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/"},"kubeconfig")," file (default location is ",(0,o.kt)("inlineCode",{parentName:"li"},"~/.kube/config"),")."),(0,o.kt)("li",{parentName:"ul"},"Installed ",(0,o.kt)("a",{parentName:"li",href:"https://helm.sh/"},"helm")," command-line tool."),(0,o.kt)("li",{parentName:"ul"},"Installed ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/kubernetes/ingress-nginx"},"ingress-nginx")," or any other ingress controller.")),(0,o.kt)("h2",{id:"installation-process"},"Installation Process"),(0,o.kt)("p",null,"We use helm to organize Horizon's whole dependencies, which means you can launch a whole CI&CD system by Helm."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Kind on Mac")),(0,o.kt)("p",null,"Assuming you have installed ",(0,o.kt)("inlineCode",{parentName:"p"},"Homebrew")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"kubectl"),", you need to do the following steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Prepare container runtime by using ",(0,o.kt)("inlineCode",{parentName:"li"},"colima"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"brew install colima\n\n# Launch Docker runtime by default\ncolima start --cpu 4 --memory 12\n\n# Or create VM with Rosetta 2 emulation (for MacOS Ventura)\ncolima start --cpu 4 --memory 12 --vm-type=vz --vz-rosetta\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Prepare ",(0,o.kt)("inlineCode",{parentName:"li"},"docker")," client")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"brew install docker\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Deploy a ",(0,o.kt)("inlineCode",{parentName:"li"},"kubernetes")," cluster by ",(0,o.kt)("inlineCode",{parentName:"li"},"Kind"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'# install kind\nbrew install kind\n\n\n# prepare a kind configuration file `kind.yaml`:\ncat <<EOF > kind.yaml\nkind: Cluster\napiVersion: kind.x-k8s.io/v1alpha4\nnodes:\n  - role: control-plane\n    kubeadmConfigPatches:\n      - |\n        kind: InitConfiguration\n        nodeRegistration:\n          kubeletExtraArgs:\n            node-labels: "ingress-ready=true"\n    extraPortMappings:\n      - containerPort: 80\n        hostPort: 80\n        protocol: TCP\n      - containerPort: 443\n        hostPort: 443\n        protocol: TCP\nEOF\n\n# install k8s\nkind create cluster --image=kindest/node:v1.19.16 --config=kind.yaml\n')),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Install ",(0,o.kt)("inlineCode",{parentName:"li"},"ingress-nginx")," by helm")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm install my-ingress-nginx ingress-nginx/ingress-nginx --version 3.21.0 --set controller.hostNetwork=true\n")),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"Install ",(0,o.kt)("inlineCode",{parentName:"li"},"Horizon")," by helm")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"helm repo add horizon https://horizoncd.github.io/helm-charts\nhelm install horizon horizon/horizon -n horizoncd --version 2.0.1 --create-namespace\n")),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"Check service status of ",(0,o.kt)("inlineCode",{parentName:"li"},"Horizon"),". If everything goes well, you can first use ",(0,o.kt)("inlineCode",{parentName:"li"},"kubectl")," to check if all pods are running well.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"(\u2388 |kind-kind:horizoncd)\u279c  ~ kubectl get pod -nhorizoncd\nNAME                                                 READY   STATUS      RESTARTS   AGE\nel-horizon-listener-f5dcd8958-tx675                  1/1     Running     0          26m\nhorizon-argocd-application-controller-0              1/1     Running     0          39m\nhorizon-argocd-repo-server-5c89969bbb-l8hcr          1/1     Running     0          40m\nhorizon-argocd-server-579fdbf68c-9p8wr               1/1     Running     0          40m\nhorizon-chartmuseum-5db87d9dc8-8j6b9                 1/1     Running     4          40m\nhorizon-core-64df467d7-jtdl6                         1/1     Running     0          24m\nhorizon-gitlab-75d5c47c96-zzjpl                      1/1     Running     0          17h\nhorizon-grafana-78c956d9b6-6th7p                     3/3     Running     0          17h\nhorizon-harbor-core-86944d7f76-q2lcb                 1/1     Running     2          26m\nhorizon-harbor-database-0                            1/1     Running     0          39m\nhorizon-harbor-jobservice-569559cfd8-c2plt           1/1     Running     2          26m\nhorizon-harbor-nginx-7f7cc9b669-64nxz                1/1     Running     0          26m\nhorizon-harbor-portal-555876fd5-q9mc5                1/1     Running     0          40m\nhorizon-harbor-registry-77977b5d58-64m6l             2/2     Running     0          26m\nhorizon-job-bfbc7cb4d-td64p                          1/1     Running     0          37m\nhorizon-minio-74c84b8c4f-qsdj2                       1/1     Running     0          39m\nhorizon-minio-provisioning-9tgz8                     0/1     Completed   0          26m\nhorizon-mysql-0                                      1/1     Running     0          39m\nhorizon-redis-ha-server-0                            2/2     Running     0          25m\nhorizon-swagger-676fbc8ff9-w8tq7                     1/1     Running     0          40m\nhorizon-web-5784d89d46-g7bx7                         1/1     Running     0          40m\ntekton-dashboard-598fb5b5b7-xmfsz                    1/1     Running     0          40m\ntekton-pipelines-controller-688d99f585-kvb58         1/1     Running     0          40m\ntekton-pipelines-webhook-86bd954957-6n7m2            1/1     Running     1          40m\ntekton-triggers-controller-f45c96768-pg8sv           1/1     Running     0          40m\ntekton-triggers-core-interceptors-857dcb75b6-lbprb   1/1     Running     0          40m\ntekton-triggers-webhook-559b5b98cc-c7tmj             1/1     Running     0          40m\n")),(0,o.kt)("p",null,"If all pods are healthy, you can enter Horizon by visiting the url: ",(0,o.kt)("a",{parentName:"p",href:"http://horizon.h8r.site"},"http://horizon.h8r.site"),", and you will see the page like below:"),(0,o.kt)("img",{src:"/image/home.png",style:{boxShadow:"10px 5px 5px grey",radius:"10px"}}),(0,o.kt)("p",null,"Next, please go to ",(0,o.kt)("a",{parentName:"p",href:"/docs/tutorials/how-to-deploy-your-first-workload"},"how to deploy your fist workload")," to experience this amazing CI&CD system more closely."),(0,o.kt)("h3",{id:"known-issues"},"Known Issues"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Node in K8s cannot resolve service domain successfully by default, so you need to set serviceIP of ",(0,o.kt)("inlineCode",{parentName:"li"},"coredns")," as a ",(0,o.kt)("inlineCode",{parentName:"li"},"nameserver")," in ",(0,o.kt)("inlineCode",{parentName:"li"},"/etc/resolv.conf"),".")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'\u2388 |kind-kind:horizoncd)\u279c  ~ docker ps\nCONTAINER ID   IMAGE                   COMMAND                  CREATED      STATUS       PORTS                                                                 NAMES\na9902c293760   kindest/node:v1.19.16   "/usr/local/bin/entr\u2026"   3 days ago   Up 6 hours   0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp, 127.0.0.1:53586->6443/tcp   kind-control-plane\n(\u2388 |kind-kind:horizoncd)\u279c  ~ docker exec -it a9902c293760 bash\nroot@kind-control-plane:/# echo "nameserver `kubectl get service -n kube-system kube-dns -o jsonpath=\'{.spec.clusterIP}\'`" >> /etc/resolv.conf\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Harbor")," installed by ",(0,o.kt)("inlineCode",{parentName:"li"},"Horizon")," uses an auto-generated tls certificate which will cause ",(0,o.kt)("inlineCode",{parentName:"li"},"X509")," problem when pulling image on host, so you need to add some contents to the config of ",(0,o.kt)("inlineCode",{parentName:"li"},"Containerd")," and restart it.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'\u2388 |kind-kind:horizoncd)\u279c  ~ docker ps\nCONTAINER ID   IMAGE                   COMMAND                  CREATED      STATUS       PORTS                                                                 NAMES\na9902c293760   kindest/node:v1.19.16   "/usr/local/bin/entr\u2026"   3 days ago   Up 6 hours   0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp, 127.0.0.1:53586->6443/tcp   kind-control-plane\n(\u2388 |kind-kind:horizoncd)\u279c  ~ docker exec -it a9902c293760 bash\nroot@kind-control-plane:/# echo \'[plugins."io.containerd.grpc.v1.cri".registry.configs."harbor.horizoncd.svc.cluster.local".tls]\n  insecure_skip_verify = true\' >> /etc/containerd/config.toml\nroot@kind-control-plane:/# systemctl restart containerd\n')),(0,o.kt)("h2",{id:"horizon-components"},"Horizon Components"),(0,o.kt)("p",null,"The table below lists the key components that are deployed when you deploy Horizon."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Component"),(0,o.kt)("th",{parentName:"tr",align:null},"Version"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Gitlab"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"15.5.1-ce.0"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Argo-cd"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"v2.4.11"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Tekton"),(0,o.kt)("td",{parentName:"tr",align:null},"dashboard:",(0,o.kt)("inlineCode",{parentName:"td"}," v0.11.1"),(0,o.kt)("br",null),"pipeline:\xa0",(0,o.kt)("inlineCode",{parentName:"td"},"v0.18.1"),(0,o.kt)("br",null),"triggers:\xa0",(0,o.kt)("inlineCode",{parentName:"td"},"v0.11.2"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Chartmuseum"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"v0.15.0"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Grafana"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"8.4.6"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Minio"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"2022.10.29-debian-11-r0"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Redis"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"6.0.7-alpine"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Mysql"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"8.0.31-debian-11-r0"))))))}c.isMDXComponent=!0}}]);